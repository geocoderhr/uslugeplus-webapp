<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>UslugePlus</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
  :root{
    --accent:#3390ec;
    --r-card:18px;
    --r-item:14px;
    --b: rgba(0,0,0,0.10);
    --shadow: 0 18px 48px rgba(0,0,0,0.22);
  }

  body{
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: var(--tg-theme-bg-color, #0b0f17);
    color: var(--tg-theme-text-color, #e9eef7);
    margin:0;
    padding:14px 14px 22px;
    min-height:100vh;

    display:flex;
    flex-direction:column;
    align-items:stretch;
    justify-content:flex-start;
  }

  .hidden{display:none;}

  .loader{
    border: 4px solid rgba(0,0,0,0.08);
    border-top: 4px solid var(--accent);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1.1s linear infinite;
    margin: 34px auto 0;
  }
  @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

  .card{
    width:100%;
    max-width:560px;
    margin: 0 auto;
    background: var(--tg-theme-secondary-bg-color, rgba(255,255,255,0.06));
    border: 1px solid var(--b);
    border-radius: var(--r-card);
    padding: 18px 16px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  h3{
    margin: 0 0 8px 0;
    font-size: 22px;
    font-weight: 850;
    letter-spacing: -0.2px;
  }

  p{
    margin: 0 0 14px 0;
    font-size: 15px;
    line-height: 1.35;
    color: var(--tg-theme-hint-color, rgba(233,238,247,0.75));
  }

  .lang-option{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding: 14px 14px;
    border-radius: var(--r-item);
    background: rgba(0,0,0,0.05);
    border: 1px solid rgba(0,0,0,0.10);
    cursor:pointer;
    user-select:none;
    font-weight: 800;
    margin-top: 12px;
    transition: transform .08s ease, border-color .12s ease, background .12s ease;
  }

  /* –≤—ã–±—Ä–∞–Ω–Ω—ã–π (RU) —á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π */
  #lang-ru{
    border-color: rgba(51,144,236,0.55);
    background: rgba(51,144,236,0.08);
  }

  .lang-option:active{transform: scale(0.99);}

  .lang-option.disabled{
    opacity:0.52;
    cursor:not-allowed;
  }

  .badge{
    font-size:12px;
    padding: 4px 10px;
    border-radius: 999px;
    background: rgba(0,0,0,0.10);
    color: var(--tg-theme-hint-color, rgba(233,238,247,0.75));
    border: 1px solid rgba(0,0,0,0.10);
    white-space:nowrap;
  }

  /* –±–µ–π–¥–∂ —É –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —è–∑—ã–∫–∞ */
  #lang-ru .badge{
    background: rgba(51,144,236,0.18);
    border-color: rgba(51,144,236,0.35);
    color: var(--tg-theme-text-color, #e9eef7);
  }

  .menu-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    width:100%;
    max-width:560px;
    margin: 14px auto 0;
  }

  .menu-item{
    background: var(--tg-theme-secondary-bg-color, rgba(255,255,255,0.06));
    padding: 16px;
    border-radius: 14px;
    text-align:center;
    cursor:pointer;
    border: 1px solid var(--b);
    font-weight: 850;
    box-shadow: 0 10px 26px rgba(0,0,0,0.16);
    transition: transform .08s ease;
  }
  .menu-item:active{transform: scale(0.99);}
</style>
</head>
<body>

  <!-- Screen: Language picker (first launch) -->
  <div id="lang-screen" class="hidden">
    <div class="card">
      <h3 id="lang-title">–Ø–∑—ã–∫</h3>
      <p id="lang-subtitle">–í—ã–±–µ—Ä–∏ —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –ü–æ—Ç–æ–º –µ–≥–æ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–º–µ–Ω—è—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª–µ.</p>

      <div class="lang-option" id="lang-ru">
        <span>–†—É—Å—Å–∫–∏–π</span>
        <span class="badge" id="lang-ru-badge">—Å–µ–π—á–∞—Å</span>
      </div>

      <div class="lang-option disabled" id="lang-hr">
        <span>Hrvatski</span>
        <span class="badge" id="lang-hr-badge">–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</span>
      </div>
    </div>
  </div>

  <!-- Screen: Loading/Auth -->
  <div id="loading-screen" class="hidden">
    <div class="loader"></div>
    <p id="loading-text">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...</p>
  </div>

  <!-- Screen: Main Menu (temporary, –ø–æ–∫–∞ –Ω–µ—Ç Policy/Profile) -->
  <div id="main-menu" class="hidden">
    <h3 id="menu-title">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h3>
    <div class="menu-grid">
      <div class="menu-item" onclick="action('create_request')" id="menu-create">üìù –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</div>
      <div class="menu-item" onclick="action('be_provider')" id="menu-provider">üõ† –Ø –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</div>
      <div class="menu-item" onclick="action('profile')" id="menu-profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
      <div class="menu-item" onclick="action('referral')" id="menu-referral">üéÅ –ë–æ–Ω—É—Å—ã</div>
      <div class="menu-item" onclick="action('reset_app')" id="menu-reset">‚ôªÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</div>
    </div>
  </div>

  <script>
    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
    if (tg) { tg.ready(); tg.expand(); }

    // i18n skeleton: RU —Å–µ–π—á–∞—Å, HR –ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞ (–≥–æ—Ç–æ–≤–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–¥ EN –ø–æ–∑–∂–µ)
    const I18N = {
      ru: {
        lang_title: '–Ø–∑—ã–∫',
        lang_subtitle: '–í—ã–±–µ—Ä–∏ —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –ü–æ—Ç–æ–º –µ–≥–æ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–º–µ–Ω—è—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª–µ.',
        ru_badge: '—Å–µ–π—á–∞—Å',
        hr_badge: '–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ',
        loading: '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...',
        menu_title: '–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é',
        m_create: 'üìù –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É',
        m_provider: 'üõ† –Ø –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å',
        m_profile: 'üë§ –ü—Ä–æ—Ñ–∏–ª—å',
        m_referral: 'üéÅ –ë–æ–Ω—É—Å—ã',
        m_reset: '‚ôªÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ',
        auth_error: '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.',
        net_error: '–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º',
        hr_soon: 'Hrvatski –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.'
      },
      hr: {
        // –ü–æ–∫–∞ –ø—É—Å—Ç–æ: –æ—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∫–ª—é—á–∏
      }
    };

    let lang = localStorage.getItem('up_lang') || 'ru';

    function t(key) {
      const pack = I18N[lang] || I18N.ru;
      return (pack && pack[key]) || (I18N.ru[key]) || key;
    }

    function applyTexts() {
      document.documentElement.lang = lang;

      const set = (id, value) => { const el = document.getElementById(id); if (el) el.textContent = value; };

      set('lang-title', t('lang_title'));
      set('lang-subtitle', t('lang_subtitle'));
      set('lang-ru-badge', t('ru_badge'));
      set('lang-hr-badge', t('hr_badge'));

      set('loading-text', t('loading'));
      set('menu-title', t('menu_title'));

      set('menu-create', t('m_create'));
      set('menu-provider', t('m_provider'));
      set('menu-profile', t('m_profile'));
      set('menu-referral', t('m_referral'));
      set('menu-reset', t('m_reset'));
    }

    function showOnly(screenId) {
      const ids = ['lang-screen', 'loading-screen', 'main-menu'];
      ids.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        if (id === screenId) el.classList.remove('hidden');
        else el.classList.add('hidden');
      });
    }

    function setLang(next) {
      lang = next;
      localStorage.setItem('up_lang', lang);
      applyTexts();
    }

    async function startAuth() {
      showOnly('loading-screen');

      try {
        const response = await fetch('https://api.uslugeplus.com/auth/telegram', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ initData: tg ? tg.initData : '' })
        });

        const data = await response.json();

        if (data.ok) {
          showOnly('main-menu');
          console.log('User authorized:', data.user);
        } else {
          alert(t('auth_error'));
        }
      } catch (e) {
        alert(t('net_error'));
      }
    }

    function bootstrap() {
      applyTexts();

      const saved = localStorage.getItem('up_lang');
      if (!saved) {
        showOnly('lang-screen');

        const ru = document.getElementById('lang-ru');
        const hr = document.getElementById('lang-hr');

        if (ru) {
          ru.onclick = () => {
            if (tg) tg.HapticFeedback.impactOccurred('light');
            setLang('ru');
            startAuth();
          };
        }

        if (hr) {
          hr.onclick = () => {
            if (tg) tg.HapticFeedback.impactOccurred('light');
            alert(t('hr_soon'));
          };
        }
      } else {
        setLang(saved);
        startAuth();
      }
    }

    function action(type) {
      if (tg) tg.HapticFeedback.impactOccurred('light');

      if (type === 'reset_app') {
        localStorage.removeItem('up_lang');
        location.reload();
        return;
      }

      alert('–í—ã–±—Ä–∞–Ω–æ: ' + type + '. –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ n8n!');
    }

    bootstrap();
  </script>
</body>
</html>
